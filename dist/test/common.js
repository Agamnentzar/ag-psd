"use strict";
/// <reference types="mocha" />
/// <reference path="../../typings/chai.d.ts" />
/// <reference path="../../typings/canvas.d.ts" />
Object.defineProperty(exports, "__esModule", { value: true });
exports.expectBuffersEqual = exports.compareBuffers = exports.compareCanvases = exports.compareTwoFiles = exports.loadCanvasFromFile = exports.saveCanvas = exports.extractPSD = exports.readPsdFromFile = exports.createReaderFromBuffer = exports.loadImagesFromDirectory = exports.importPSD = exports.range = exports.repeat = exports.toArrayBuffer = exports.createCanvas = void 0;
require('source-map-support').install();
var fs = require("fs");
var path = require("path");
var canvas_1 = require("canvas");
Object.defineProperty(exports, "createCanvas", { enumerable: true, get: function () { return canvas_1.createCanvas; } });
require("../initializeCanvas");
var psdReader_1 = require("../psdReader");
var descriptor_1 = require("../descriptor");
(0, descriptor_1.setLogErrors)(true);
var resultsPath = path.join(__dirname, '..', '..', 'results');
function toArrayBuffer(buffer) {
    var ab = new ArrayBuffer(buffer.length);
    var view = new Uint8Array(ab);
    for (var i = 0; i < buffer.length; ++i) {
        view[i] = buffer[i];
    }
    return ab;
}
exports.toArrayBuffer = toArrayBuffer;
function repeat(times) {
    var values = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        values[_i - 1] = arguments[_i];
    }
    if (!values.length) {
        throw new Error('missing values');
    }
    var array = [];
    for (var i = 0; i < times; i++) {
        array.push.apply(array, values);
    }
    return array;
}
exports.repeat = repeat;
function range(start, length) {
    var array = [];
    for (var i = 0; i < length; i++) {
        array.push(start + i);
    }
    return array;
}
exports.range = range;
function importPSD(dirName) {
    var dataPath = path.join(dirName, 'data.json');
    if (!fs.existsSync(dataPath))
        return undefined;
    return JSON.parse(fs.readFileSync(dataPath, 'utf8'));
}
exports.importPSD = importPSD;
function loadImagesFromDirectory(dirName) {
    var images = {};
    fs.readdirSync(dirName)
        .filter(function (f) { return /\.png$/.test(f); })
        .forEach(function (f) { return images[f] = loadCanvasFromFile(path.join(dirName, f)); });
    return images;
}
exports.loadImagesFromDirectory = loadImagesFromDirectory;
function createReaderFromBuffer(buffer) {
    return (0, psdReader_1.createReader)(buffer.buffer, buffer.byteOffset, buffer.byteLength);
}
exports.createReaderFromBuffer = createReaderFromBuffer;
function readPsdFromFile(fileName, options) {
    var buffer = fs.readFileSync(fileName);
    var reader = createReaderFromBuffer(buffer);
    return (0, psdReader_1.readPsd)(reader, options);
}
exports.readPsdFromFile = readPsdFromFile;
function extractPSD(filePath, psd) {
    var basePath = path.join(resultsPath, filePath);
    if (!fs.existsSync(basePath))
        fs.mkdirSync(basePath);
    if (psd.canvas) {
        fs.writeFileSync(path.join(basePath, 'canvas.png'), psd.canvas.toBuffer());
        psd.canvas = undefined;
    }
    psd.children.forEach(function (l, i) {
        if (l.canvas) {
            fs.writeFileSync(path.join(basePath, "layer-".concat(i, ".png")), l.canvas.toBuffer());
            l.canvas = undefined;
        }
    });
    fs.writeFileSync(path.join(basePath, 'data.json'), JSON.stringify(psd, null, 2));
}
exports.extractPSD = extractPSD;
function saveCanvas(fileName, canvas) {
    if (canvas) {
        fs.writeFileSync(fileName, canvas.toBuffer());
    }
}
exports.saveCanvas = saveCanvas;
function loadCanvasFromFile(filePath) {
    var img = new canvas_1.Image();
    img.src = fs.readFileSync(filePath);
    var canvas = (0, canvas_1.createCanvas)(img.width, img.height);
    canvas.getContext('2d').drawImage(img, 0, 0);
    return canvas;
}
exports.loadCanvasFromFile = loadCanvasFromFile;
function compareTwoFiles(expectedPath, actual, name) {
    var expectedBuffer = fs.readFileSync(expectedPath);
    var expected = new Uint8Array(expectedBuffer.buffer, expectedBuffer.byteOffset, expectedBuffer.byteLength);
    if (expected.byteLength !== actual.byteLength) {
        throw new Error("File size is different than expected (".concat(name, ")"));
    }
    for (var i = 0; i < expected.byteLength; i++) {
        if (expected[i] !== actual[i]) {
            throw new Error("Actual file different than expected at index ".concat(i, ": actual ").concat(actual[i], ", expected ").concat(expected[i]));
        }
    }
}
exports.compareTwoFiles = compareTwoFiles;
function compareCanvases(expected, actual, name) {
    var saveFailure = function () {
        var failuresDir = path.join(resultsPath, 'failures');
        if (!fs.existsSync(failuresDir)) {
            fs.mkdirSync(failuresDir);
        }
        fs.writeFileSync(path.join(failuresDir, "".concat(name.replace(/[\\/]/, '-'))), actual.toBuffer());
    };
    if (expected === actual)
        return;
    if (!expected)
        throw new Error("Expected canvas is null (".concat(name, ")"));
    if (!actual)
        throw new Error("Actual canvas is null (".concat(name, ")"));
    if (expected.width !== actual.width || expected.height !== actual.height) {
        saveFailure();
        throw new Error("Canvas size is different than expected (".concat(name, ")"));
    }
    var expectedData = expected.getContext('2d').getImageData(0, 0, expected.width, expected.height);
    var actualData = actual.getContext('2d').getImageData(0, 0, actual.width, actual.height);
    var length = expectedData.width * expectedData.height * 4;
    for (var i = 0; i < length; i++) {
        if (expectedData.data[i] !== actualData.data[i]) {
            saveFailure();
            var expectedNumBytes = expectedData.data.length;
            var actualNumBytes = actualData.data.length;
            throw new Error("Actual canvas (".concat(actualNumBytes, " bytes) different ") +
                "than expected (".concat(name, ": ").concat(expectedNumBytes, " bytes) ") +
                "at index ".concat(i, ": actual ").concat(actualData.data[i], " vs. expected ").concat(expectedData.data[i]));
        }
    }
}
exports.compareCanvases = compareCanvases;
function compareBuffers(actual, expected, test, start, offset) {
    if (start === void 0) { start = 0; }
    if (offset === void 0) { offset = 0; }
    if (!actual)
        throw new Error("Actual buffer is null or undefined (".concat(test, ")"));
    if (!expected)
        throw new Error("Expected buffer is null or undefined (".concat(test, ")"));
    for (var i = start; i < expected.length; i++) {
        if (expected[i] !== actual[i + offset]) {
            throw new Error("Buffers differ " +
                "expected: 0x".concat(expected[i].toString(16), " at [0x").concat(i.toString(16), "] ") +
                "actual: 0x".concat(actual[i + offset].toString(16), " at [0x").concat((i + offset).toString(16), "] (").concat(test, ")"));
        }
    }
    if (actual.length !== expected.length)
        throw new Error("Buffers differ in size actual: ".concat(actual.length, " expected: ").concat(expected.length, " (").concat(test, ")"));
}
exports.compareBuffers = compareBuffers;
function expectBuffersEqual(actual, expected, name) {
    var length = Math.max(actual.length, expected.length);
    for (var i = 0; i < length; i++) {
        if (actual[i] !== expected[i]) {
            fs.writeFileSync(path.join(__dirname, '..', '..', 'results', name), Buffer.from(actual));
            throw new Error("Different byte at 0x".concat(i.toString(16), " in (").concat(name, ")"));
        }
    }
}
exports.expectBuffersEqual = expectBuffersEqual;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFHLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsb0JBQVUsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxnQkFBTSxJQUFJLE1BQUcsQ0FBQyxDQUFDO1NBQy9GO0tBQ0Q7SUFFRCxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssUUFBUSxDQUFDLE1BQU07UUFDcEMsTUFBTSxJQUFJLEtBQUssQ0FBQyx5Q0FBa0MsTUFBTSxDQUFDLE1BQU0sd0JBQWMsUUFBUSxDQUFDLE1BQU0sZUFBSyxJQUFJLE1BQUcsQ0FBQyxDQUFDO0FBQzVHLENBQUM7QUFoQkQsd0NBZ0JDO0FBR0QsU0FBZ0Isa0JBQWtCLENBQUMsTUFBa0IsRUFBRSxRQUFvQixFQUFFLElBQVk7SUFDeEYsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUV4RCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2hDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUM5QixFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN6RixNQUFNLElBQUksS0FBSyxDQUFDLDhCQUF1QixDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxrQkFBUSxJQUFJLE1BQUcsQ0FBQyxDQUFDO1NBQ3RFO0tBQ0Q7QUFDRixDQUFDO0FBVEQsZ0RBU0MiLCJmaWxlIjoidGVzdC9jb21tb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSB0eXBlcz1cIm1vY2hhXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvY2hhaS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvY2FudmFzLmQudHNcIiAvPlxyXG5cclxucmVxdWlyZSgnc291cmNlLW1hcC1zdXBwb3J0JykuaW5zdGFsbCgpO1xyXG5cclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgeyBjcmVhdGVDYW52YXMsIEltYWdlIH0gZnJvbSAnY2FudmFzJztcclxuaW1wb3J0ICcuLi9pbml0aWFsaXplQ2FudmFzJztcclxuaW1wb3J0IHsgUHNkLCBSZWFkT3B0aW9ucyB9IGZyb20gJy4uL2luZGV4JztcclxuaW1wb3J0IHsgcmVhZFBzZCwgY3JlYXRlUmVhZGVyIH0gZnJvbSAnLi4vcHNkUmVhZGVyJztcclxuaW1wb3J0IHsgc2V0TG9nRXJyb3JzIH0gZnJvbSAnLi4vZGVzY3JpcHRvcic7XHJcbmV4cG9ydCB7IGNyZWF0ZUNhbnZhcyB9O1xyXG5cclxuc2V0TG9nRXJyb3JzKHRydWUpO1xyXG5cclxuY29uc3QgcmVzdWx0c1BhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAncmVzdWx0cycpO1xyXG5cclxuZXhwb3J0IHR5cGUgSW1hZ2VNYXAgPSB7IFtrZXk6IHN0cmluZ106IEhUTUxDYW52YXNFbGVtZW50IH07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9BcnJheUJ1ZmZlcihidWZmZXI6IEJ1ZmZlcikge1xyXG5cdGNvbnN0IGFiID0gbmV3IEFycmF5QnVmZmVyKGJ1ZmZlci5sZW5ndGgpO1xyXG5cdGNvbnN0IHZpZXcgPSBuZXcgVWludDhBcnJheShhYik7XHJcblxyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgYnVmZmVyLmxlbmd0aDsgKytpKSB7XHJcblx0XHR2aWV3W2ldID0gYnVmZmVyW2ldO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIGFiO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVwZWF0PFQ+KHRpbWVzOiBudW1iZXIsIC4uLnZhbHVlczogVFtdKTogVFtdIHtcclxuXHRpZiAoIXZhbHVlcy5sZW5ndGgpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcignbWlzc2luZyB2YWx1ZXMnKTtcclxuXHR9XHJcblxyXG5cdGNvbnN0IGFycmF5OiBUW10gPSBbXTtcclxuXHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aW1lczsgaSsrKSB7XHJcblx0XHRhcnJheS5wdXNoKC4uLnZhbHVlcyk7XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gYXJyYXk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByYW5nZShzdGFydDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IG51bWJlcltdIHtcclxuXHRjb25zdCBhcnJheTogbnVtYmVyW10gPSBbXTtcclxuXHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG5cdFx0YXJyYXkucHVzaChzdGFydCArIGkpO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIGFycmF5O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW1wb3J0UFNEKGRpck5hbWU6IHN0cmluZyk6IFBzZCB8IHVuZGVmaW5lZCB7XHJcblx0Y29uc3QgZGF0YVBhdGggPSBwYXRoLmpvaW4oZGlyTmFtZSwgJ2RhdGEuanNvbicpO1xyXG5cclxuXHRpZiAoIWZzLmV4aXN0c1N5bmMoZGF0YVBhdGgpKVxyXG5cdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHJcblx0cmV0dXJuIEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGRhdGFQYXRoLCAndXRmOCcpKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRJbWFnZXNGcm9tRGlyZWN0b3J5KGRpck5hbWU6IHN0cmluZykge1xyXG5cdGNvbnN0IGltYWdlczogSW1hZ2VNYXAgPSB7fTtcclxuXHJcblx0ZnMucmVhZGRpclN5bmMoZGlyTmFtZSlcclxuXHRcdC5maWx0ZXIoZiA9PiAvXFwucG5nJC8udGVzdChmKSlcclxuXHRcdC5mb3JFYWNoKGYgPT4gaW1hZ2VzW2ZdID0gbG9hZENhbnZhc0Zyb21GaWxlKHBhdGguam9pbihkaXJOYW1lLCBmKSkpO1xyXG5cclxuXHRyZXR1cm4gaW1hZ2VzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVhZGVyRnJvbUJ1ZmZlcihidWZmZXI6IEJ1ZmZlcikge1xyXG5cdHJldHVybiBjcmVhdGVSZWFkZXIoYnVmZmVyLmJ1ZmZlciwgYnVmZmVyLmJ5dGVPZmZzZXQsIGJ1ZmZlci5ieXRlTGVuZ3RoKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRQc2RGcm9tRmlsZShmaWxlTmFtZTogc3RyaW5nLCBvcHRpb25zPzogUmVhZE9wdGlvbnMpOiBQc2Qge1xyXG5cdGNvbnN0IGJ1ZmZlciA9IGZzLnJlYWRGaWxlU3luYyhmaWxlTmFtZSk7XHJcblx0Y29uc3QgcmVhZGVyID0gY3JlYXRlUmVhZGVyRnJvbUJ1ZmZlcihidWZmZXIpO1xyXG5cdHJldHVybiByZWFkUHNkKHJlYWRlciwgb3B0aW9ucyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0UFNEKGZpbGVQYXRoOiBzdHJpbmcsIHBzZDogUHNkKSB7XHJcblx0Y29uc3QgYmFzZVBhdGggPSBwYXRoLmpvaW4ocmVzdWx0c1BhdGgsIGZpbGVQYXRoKTtcclxuXHJcblx0aWYgKCFmcy5leGlzdHNTeW5jKGJhc2VQYXRoKSlcclxuXHRcdGZzLm1rZGlyU3luYyhiYXNlUGF0aCk7XHJcblxyXG5cdGlmIChwc2QuY2FudmFzKSB7XHJcblx0XHRmcy53cml0ZUZpbGVTeW5jKHBhdGguam9pbihiYXNlUGF0aCwgJ2NhbnZhcy5wbmcnKSwgcHNkLmNhbnZhcy50b0J1ZmZlcigpKTtcclxuXHRcdHBzZC5jYW52YXMgPSB1bmRlZmluZWQ7XHJcblx0fVxyXG5cclxuXHRwc2QuY2hpbGRyZW4hLmZvckVhY2goKGwsIGkpID0+IHtcclxuXHRcdGlmIChsLmNhbnZhcykge1xyXG5cdFx0XHRmcy53cml0ZUZpbGVTeW5jKHBhdGguam9pbihiYXNlUGF0aCwgYGxheWVyLSR7aX0ucG5nYCksIGwuY2FudmFzLnRvQnVmZmVyKCkpO1xyXG5cdFx0XHRsLmNhbnZhcyA9IHVuZGVmaW5lZDtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oYmFzZVBhdGgsICdkYXRhLmpzb24nKSwgSlNPTi5zdHJpbmdpZnkocHNkLCBudWxsLCAyKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzYXZlQ2FudmFzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgfCB1bmRlZmluZWQpIHtcclxuXHRpZiAoY2FudmFzKSB7XHJcblx0XHRmcy53cml0ZUZpbGVTeW5jKGZpbGVOYW1lLCBjYW52YXMudG9CdWZmZXIoKSk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbG9hZENhbnZhc0Zyb21GaWxlKGZpbGVQYXRoOiBzdHJpbmcpIHtcclxuXHRjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHRpbWcuc3JjID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoKTtcclxuXHRjb25zdCBjYW52YXMgPSBjcmVhdGVDYW52YXMoaW1nLndpZHRoLCBpbWcuaGVpZ2h0KTtcclxuXHRjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSEuZHJhd0ltYWdlKGltZywgMCwgMCk7XHJcblx0cmV0dXJuIGNhbnZhcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVUd29GaWxlcyhleHBlY3RlZFBhdGg6IHN0cmluZywgYWN0dWFsOiBVaW50OEFycmF5LCBuYW1lOiBzdHJpbmcpIHtcclxuXHRjb25zdCBleHBlY3RlZEJ1ZmZlciA9IGZzLnJlYWRGaWxlU3luYyhleHBlY3RlZFBhdGgpO1xyXG5cdGNvbnN0IGV4cGVjdGVkID0gbmV3IFVpbnQ4QXJyYXkoZXhwZWN0ZWRCdWZmZXIuYnVmZmVyLCBleHBlY3RlZEJ1ZmZlci5ieXRlT2Zmc2V0LCBleHBlY3RlZEJ1ZmZlci5ieXRlTGVuZ3RoKTtcclxuXHJcblx0aWYgKGV4cGVjdGVkLmJ5dGVMZW5ndGggIT09IGFjdHVhbC5ieXRlTGVuZ3RoKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEZpbGUgc2l6ZSBpcyBkaWZmZXJlbnQgdGhhbiBleHBlY3RlZCAoJHtuYW1lfSlgKTtcclxuXHR9XHJcblxyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgZXhwZWN0ZWQuYnl0ZUxlbmd0aDsgaSsrKSB7XHJcblx0XHRpZiAoZXhwZWN0ZWRbaV0gIT09IGFjdHVhbFtpXSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEFjdHVhbCBmaWxlIGRpZmZlcmVudCB0aGFuIGV4cGVjdGVkIGF0IGluZGV4ICR7aX06IGFjdHVhbCAke2FjdHVhbFtpXX0sIGV4cGVjdGVkICR7ZXhwZWN0ZWRbaV19YCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZUNhbnZhc2VzKGV4cGVjdGVkOiBIVE1MQ2FudmFzRWxlbWVudCB8IHVuZGVmaW5lZCwgYWN0dWFsOiBIVE1MQ2FudmFzRWxlbWVudCB8IHVuZGVmaW5lZCwgbmFtZTogc3RyaW5nKSB7XHJcblx0Y29uc3Qgc2F2ZUZhaWx1cmUgPSAoKSA9PiB7XHJcblx0XHRjb25zdCBmYWlsdXJlc0RpciA9IHBhdGguam9pbihyZXN1bHRzUGF0aCwgJ2ZhaWx1cmVzJyk7XHJcblx0XHRpZiAoIWZzLmV4aXN0c1N5bmMoZmFpbHVyZXNEaXIpKSB7XHJcblx0XHRcdGZzLm1rZGlyU3luYyhmYWlsdXJlc0Rpcik7XHJcblx0XHR9XHJcblx0XHRmcy53cml0ZUZpbGVTeW5jKHBhdGguam9pbihmYWlsdXJlc0RpciwgYCR7bmFtZS5yZXBsYWNlKC9bXFxcXC9dLywgJy0nKX1gKSwgYWN0dWFsIS50b0J1ZmZlcigpKTtcclxuXHR9O1xyXG5cclxuXHRpZiAoZXhwZWN0ZWQgPT09IGFjdHVhbClcclxuXHRcdHJldHVybjtcclxuXHRpZiAoIWV4cGVjdGVkKVxyXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBjYW52YXMgaXMgbnVsbCAoJHtuYW1lfSlgKTtcclxuXHRpZiAoIWFjdHVhbClcclxuXHRcdHRocm93IG5ldyBFcnJvcihgQWN0dWFsIGNhbnZhcyBpcyBudWxsICgke25hbWV9KWApO1xyXG5cclxuXHRpZiAoZXhwZWN0ZWQud2lkdGggIT09IGFjdHVhbC53aWR0aCB8fCBleHBlY3RlZC5oZWlnaHQgIT09IGFjdHVhbC5oZWlnaHQpIHtcclxuXHRcdHNhdmVGYWlsdXJlKCk7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoYENhbnZhcyBzaXplIGlzIGRpZmZlcmVudCB0aGFuIGV4cGVjdGVkICgke25hbWV9KWApO1xyXG5cdH1cclxuXHJcblx0Y29uc3QgZXhwZWN0ZWREYXRhID0gZXhwZWN0ZWQuZ2V0Q29udGV4dCgnMmQnKSEuZ2V0SW1hZ2VEYXRhKDAsIDAsIGV4cGVjdGVkLndpZHRoLCBleHBlY3RlZC5oZWlnaHQpO1xyXG5cdGNvbnN0IGFjdHVhbERhdGEgPSBhY3R1YWwuZ2V0Q29udGV4dCgnMmQnKSEuZ2V0SW1hZ2VEYXRhKDAsIDAsIGFjdHVhbC53aWR0aCwgYWN0dWFsLmhlaWdodCk7XHJcblx0Y29uc3QgbGVuZ3RoID0gZXhwZWN0ZWREYXRhLndpZHRoICogZXhwZWN0ZWREYXRhLmhlaWdodCAqIDQ7XHJcblxyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuXHRcdGlmIChleHBlY3RlZERhdGEuZGF0YVtpXSAhPT0gYWN0dWFsRGF0YS5kYXRhW2ldKSB7XHJcblx0XHRcdHNhdmVGYWlsdXJlKCk7XHJcblx0XHRcdGNvbnN0IGV4cGVjdGVkTnVtQnl0ZXMgPSBleHBlY3RlZERhdGEuZGF0YS5sZW5ndGg7XHJcblx0XHRcdGNvbnN0IGFjdHVhbE51bUJ5dGVzID0gYWN0dWFsRGF0YS5kYXRhLmxlbmd0aDtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFxyXG5cdFx0XHRcdGBBY3R1YWwgY2FudmFzICgke2FjdHVhbE51bUJ5dGVzfSBieXRlcykgZGlmZmVyZW50IGAgK1xyXG5cdFx0XHRcdGB0aGFuIGV4cGVjdGVkICgke25hbWV9OiAke2V4cGVjdGVkTnVtQnl0ZXN9IGJ5dGVzKSBgICtcclxuXHRcdFx0XHRgYXQgaW5kZXggJHtpfTogYWN0dWFsICR7YWN0dWFsRGF0YS5kYXRhW2ldfSB2cy4gZXhwZWN0ZWQgJHtleHBlY3RlZERhdGEuZGF0YVtpXX1gXHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZUJ1ZmZlcnMoYWN0dWFsOiBCdWZmZXIsIGV4cGVjdGVkOiBCdWZmZXIsIHRlc3Q6IHN0cmluZywgc3RhcnQgPSAwLCBvZmZzZXQgPSAwKSB7XHJcblx0aWYgKCFhY3R1YWwpXHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEFjdHVhbCBidWZmZXIgaXMgbnVsbCBvciB1bmRlZmluZWQgKCR7dGVzdH0pYCk7XHJcblx0aWYgKCFleHBlY3RlZClcclxuXHRcdHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgYnVmZmVyIGlzIG51bGwgb3IgdW5kZWZpbmVkICgke3Rlc3R9KWApO1xyXG5cclxuXHRmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBleHBlY3RlZC5sZW5ndGg7IGkrKykge1xyXG5cdFx0aWYgKGV4cGVjdGVkW2ldICE9PSBhY3R1YWxbaSArIG9mZnNldF0pIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBCdWZmZXJzIGRpZmZlciBgICtcclxuXHRcdFx0XHRgZXhwZWN0ZWQ6IDB4JHtleHBlY3RlZFtpXS50b1N0cmluZygxNil9IGF0IFsweCR7aS50b1N0cmluZygxNil9XSBgICtcclxuXHRcdFx0XHRgYWN0dWFsOiAweCR7YWN0dWFsW2kgKyBvZmZzZXRdLnRvU3RyaW5nKDE2KX0gYXQgWzB4JHsoaSArIG9mZnNldCkudG9TdHJpbmcoMTYpfV0gKCR7dGVzdH0pYCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRpZiAoYWN0dWFsLmxlbmd0aCAhPT0gZXhwZWN0ZWQubGVuZ3RoKVxyXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBCdWZmZXJzIGRpZmZlciBpbiBzaXplIGFjdHVhbDogJHthY3R1YWwubGVuZ3RofSBleHBlY3RlZDogJHtleHBlY3RlZC5sZW5ndGh9ICgke3Rlc3R9KWApO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGV4cGVjdEJ1ZmZlcnNFcXVhbChhY3R1YWw6IFVpbnQ4QXJyYXksIGV4cGVjdGVkOiBVaW50OEFycmF5LCBuYW1lOiBzdHJpbmcpIHtcclxuXHRjb25zdCBsZW5ndGggPSBNYXRoLm1heChhY3R1YWwubGVuZ3RoLCBleHBlY3RlZC5sZW5ndGgpO1xyXG5cclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcblx0XHRpZiAoYWN0dWFsW2ldICE9PSBleHBlY3RlZFtpXSkge1xyXG5cdFx0XHRmcy53cml0ZUZpbGVTeW5jKHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICcuLicsICdyZXN1bHRzJywgbmFtZSksIEJ1ZmZlci5mcm9tKGFjdHVhbCkpO1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYERpZmZlcmVudCBieXRlIGF0IDB4JHtpLnRvU3RyaW5nKDE2KX0gaW4gKCR7bmFtZX0pYCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiRjpcXHByb2plY3RzXFxhZy1wc2RcXHNyYyJ9
