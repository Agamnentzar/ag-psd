/// <reference types="mocha" />
/// <reference path="../../typings/chai.d.ts" />
/// <reference path="../../typings/canvas.d.ts" />
require('source-map-support').install();
import * as fs from 'fs';
import * as path from 'path';
import { createCanvas, Image } from 'canvas';
import '../initializeCanvas';
import { readPsd, createReader } from '../psdReader';
import { setLogErrors } from '../descriptor';
export { createCanvas };
setLogErrors(true);
var resultsPath = path.join(__dirname, '..', '..', 'results');
export function toArrayBuffer(buffer) {
    var ab = new ArrayBuffer(buffer.length);
    var view = new Uint8Array(ab);
    for (var i = 0; i < buffer.length; ++i) {
        view[i] = buffer[i];
    }
    return ab;
}
export function repeat(times) {
    var values = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        values[_i - 1] = arguments[_i];
    }
    if (!values.length) {
        throw new Error('missing values');
    }
    var array = [];
    for (var i = 0; i < times; i++) {
        array.push.apply(array, values);
    }
    return array;
}
export function range(start, length) {
    var array = [];
    for (var i = 0; i < length; i++) {
        array.push(start + i);
    }
    return array;
}
export function importPSD(dirName) {
    var dataPath = path.join(dirName, 'data.json');
    if (!fs.existsSync(dataPath))
        return undefined;
    return JSON.parse(fs.readFileSync(dataPath, 'utf8'));
}
export function loadImagesFromDirectory(dirName) {
    var images = {};
    fs.readdirSync(dirName)
        .filter(function (f) { return /\.png$/.test(f); })
        .forEach(function (f) { return images[f] = loadCanvasFromFile(path.join(dirName, f)); });
    return images;
}
export function createReaderFromBuffer(buffer) {
    return createReader(buffer.buffer, buffer.byteOffset, buffer.byteLength);
}
export function readPsdFromFile(fileName, options) {
    var buffer = fs.readFileSync(fileName);
    var reader = createReaderFromBuffer(buffer);
    return readPsd(reader, options);
}
export function extractPSD(filePath, psd) {
    var basePath = path.join(resultsPath, filePath);
    if (!fs.existsSync(basePath))
        fs.mkdirSync(basePath);
    if (psd.canvas) {
        fs.writeFileSync(path.join(basePath, 'canvas.png'), psd.canvas.toBuffer());
        psd.canvas = undefined;
    }
    psd.children.forEach(function (l, i) {
        if (l.canvas) {
            fs.writeFileSync(path.join(basePath, "layer-".concat(i, ".png")), l.canvas.toBuffer());
            l.canvas = undefined;
        }
    });
    fs.writeFileSync(path.join(basePath, 'data.json'), JSON.stringify(psd, null, 2));
}
export function saveCanvas(fileName, canvas) {
    if (canvas) {
        fs.writeFileSync(fileName, canvas.toBuffer());
    }
}
export function loadCanvasFromFile(filePath) {
    var img = new Image();
    img.src = fs.readFileSync(filePath);
    var canvas = createCanvas(img.width, img.height);
    canvas.getContext('2d').drawImage(img, 0, 0);
    return canvas;
}
export function compareTwoFiles(expectedPath, actual, name) {
    var expectedBuffer = fs.readFileSync(expectedPath);
    var expected = new Uint8Array(expectedBuffer.buffer, expectedBuffer.byteOffset, expectedBuffer.byteLength);
    if (expected.byteLength !== actual.byteLength) {
        throw new Error("File size is different than expected (".concat(name, ")"));
    }
    for (var i = 0; i < expected.byteLength; i++) {
        if (expected[i] !== actual[i]) {
            throw new Error("Actual file different than expected at index ".concat(i, ": actual ").concat(actual[i], ", expected ").concat(expected[i]));
        }
    }
}
export function compareCanvases(expected, actual, name) {
    var saveFailure = function () {
        var failuresDir = path.join(resultsPath, 'failures');
        if (!fs.existsSync(failuresDir)) {
            fs.mkdirSync(failuresDir);
        }
        fs.writeFileSync(path.join(failuresDir, "".concat(name.replace(/[\\/]/, '-'))), actual.toBuffer());
    };
    if (expected === actual)
        return;
    if (!expected)
        throw new Error("Expected canvas is null (".concat(name, ")"));
    if (!actual)
        throw new Error("Actual canvas is null (".concat(name, ")"));
    if (expected.width !== actual.width || expected.height !== actual.height) {
        saveFailure();
        throw new Error("Canvas size is different than expected (".concat(name, ")"));
    }
    var expectedData = expected.getContext('2d').getImageData(0, 0, expected.width, expected.height);
    var actualData = actual.getContext('2d').getImageData(0, 0, actual.width, actual.height);
    var length = expectedData.width * expectedData.height * 4;
    for (var i = 0; i < length; i++) {
        if (expectedData.data[i] !== actualData.data[i]) {
            saveFailure();
            var expectedNumBytes = expectedData.data.length;
            var actualNumBytes = actualData.data.length;
            throw new Error("Actual canvas (".concat(actualNumBytes, " bytes) different ") +
                "than expected (".concat(name, ": ").concat(expectedNumBytes, " bytes) ") +
                "at index ".concat(i, ": actual ").concat(actualData.data[i], " vs. expected ").concat(expectedData.data[i]));
        }
    }
}
export function compareBuffers(actual, expected, test, start, offset) {
    if (start === void 0) { start = 0; }
    if (offset === void 0) { offset = 0; }
    if (!actual)
        throw new Error("Actual buffer is null or undefined (".concat(test, ")"));
    if (!expected)
        throw new Error("Expected buffer is null or undefined (".concat(test, ")"));
    for (var i = start; i < expected.length; i++) {
        if (expected[i] !== actual[i + offset]) {
            throw new Error("Buffers differ " +
                "expected: 0x".concat(expected[i].toString(16), " at [0x").concat(i.toString(16), "] ") +
                "actual: 0x".concat(actual[i + offset].toString(16), " at [0x").concat((i + offset).toString(16), "] (").concat(test, ")"));
        }
    }
    if (actual.length !== expected.length)
        throw new Error("Buffers differ in size actual: ".concat(actual.length, " expected: ").concat(expected.length, " (").concat(test, ")"));
}
export function expectBuffersEqual(actual, expected, name) {
    var length = Math.max(actual.length, expected.length);
    for (var i = 0; i < length; i++) {
        if (actual[i] !== expected[i]) {
            fs.writeFileSync(path.join(__dirname, '..', '..', 'results', name), Buffer.from(actual));
            throw new Error("Different byte at 0x".concat(i.toString(16), " in (").concat(name, ")"));
        }
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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bnQiOlsiLy8vIDxyZWZlcmVuY2UgdHlwZXM9XCJtb2NoYVwiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2NoYWkuZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2NhbnZhcy5kLnRzXCIgLz5cclxuXHJcbnJlcXVpcmUoJ3NvdXJjZS1tYXAtc3VwcG9ydCcpLmluc3RhbGwoKTtcclxuXHJcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgY3JlYXRlQ2FudmFzLCBJbWFnZSB9IGZyb20gJ2NhbnZhcyc7XHJcbmltcG9ydCAnLi4vaW5pdGlhbGl6ZUNhbnZhcyc7XHJcbmltcG9ydCB7IFBzZCwgUmVhZE9wdGlvbnMgfSBmcm9tICcuLi9pbmRleCc7XHJcbmltcG9ydCB7IHJlYWRQc2QsIGNyZWF0ZVJlYWRlciB9IGZyb20gJy4uL3BzZFJlYWRlcic7XHJcbmltcG9ydCB7IHNldExvZ0Vycm9ycyB9IGZyb20gJy4uL2Rlc2NyaXB0b3InO1xyXG5leHBvcnQgeyBjcmVhdGVDYW52YXMgfTtcclxuXHJcbnNldExvZ0Vycm9ycyh0cnVlKTtcclxuXHJcbmNvbnN0IHJlc3VsdHNQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3Jlc3VsdHMnKTtcclxuXHJcbmV4cG9ydCB0eXBlIEltYWdlTWFwID0geyBba2V5OiBzdHJpbmddOiBIVE1MQ2FudmFzRWxlbWVudCB9O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRvQXJyYXlCdWZmZXIoYnVmZmVyOiBCdWZmZXIpIHtcclxuXHRjb25zdCBhYiA9IG5ldyBBcnJheUJ1ZmZlcihidWZmZXIubGVuZ3RoKTtcclxuXHRjb25zdCB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYWIpO1xyXG5cclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGJ1ZmZlci5sZW5ndGg7ICsraSkge1xyXG5cdFx0dmlld1tpXSA9IGJ1ZmZlcltpXTtcclxuXHR9XHJcblxyXG5cdHJldHVybiBhYjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlcGVhdDxUPih0aW1lczogbnVtYmVyLCAuLi52YWx1ZXM6IFRbXSk6IFRbXSB7XHJcblx0aWYgKCF2YWx1ZXMubGVuZ3RoKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ21pc3NpbmcgdmFsdWVzJyk7XHJcblx0fVxyXG5cclxuXHRjb25zdCBhcnJheTogVFtdID0gW107XHJcblxyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgdGltZXM7IGkrKykge1xyXG5cdFx0YXJyYXkucHVzaCguLi52YWx1ZXMpO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIGFycmF5O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZ2Uoc3RhcnQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBudW1iZXJbXSB7XHJcblx0Y29uc3QgYXJyYXk6IG51bWJlcltdID0gW107XHJcblxyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuXHRcdGFycmF5LnB1c2goc3RhcnQgKyBpKTtcclxuXHR9XHJcblxyXG5cdHJldHVybiBhcnJheTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGltcG9ydFBTRChkaXJOYW1lOiBzdHJpbmcpOiBQc2QgfCB1bmRlZmluZWQge1xyXG5cdGNvbnN0IGRhdGFQYXRoID0gcGF0aC5qb2luKGRpck5hbWUsICdkYXRhLmpzb24nKTtcclxuXHJcblx0aWYgKCFmcy5leGlzdHNTeW5jKGRhdGFQYXRoKSlcclxuXHRcdHJldHVybiB1bmRlZmluZWQ7XHJcblxyXG5cdHJldHVybiBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhkYXRhUGF0aCwgJ3V0ZjgnKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2FkSW1hZ2VzRnJvbURpcmVjdG9yeShkaXJOYW1lOiBzdHJpbmcpIHtcclxuXHRjb25zdCBpbWFnZXM6IEltYWdlTWFwID0ge307XHJcblxyXG5cdGZzLnJlYWRkaXJTeW5jKGRpck5hbWUpXHJcblx0XHQuZmlsdGVyKGYgPT4gL1xcLnBuZyQvLnRlc3QoZikpXHJcblx0XHQuZm9yRWFjaChmID0+IGltYWdlc1tmXSA9IGxvYWRDYW52YXNGcm9tRmlsZShwYXRoLmpvaW4oZGlyTmFtZSwgZikpKTtcclxuXHJcblx0cmV0dXJuIGltYWdlcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJlYWRlckZyb21CdWZmZXIoYnVmZmVyOiBCdWZmZXIpIHtcclxuXHRyZXR1cm4gY3JlYXRlUmVhZGVyKGJ1ZmZlci5idWZmZXIsIGJ1ZmZlci5ieXRlT2Zmc2V0LCBidWZmZXIuYnl0ZUxlbmd0aCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZWFkUHNkRnJvbUZpbGUoZmlsZU5hbWU6IHN0cmluZywgb3B0aW9ucz86IFJlYWRPcHRpb25zKTogUHNkIHtcclxuXHRjb25zdCBidWZmZXIgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZU5hbWUpO1xyXG5cdGNvbnN0IHJlYWRlciA9IGNyZWF0ZVJlYWRlckZyb21CdWZmZXIoYnVmZmVyKTtcclxuXHRyZXR1cm4gcmVhZFBzZChyZWFkZXIsIG9wdGlvbnMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdFBTRChmaWxlUGF0aDogc3RyaW5nLCBwc2Q6IFBzZCkge1xyXG5cdGNvbnN0IGJhc2VQYXRoID0gcGF0aC5qb2luKHJlc3VsdHNQYXRoLCBmaWxlUGF0aCk7XHJcblxyXG5cdGlmICghZnMuZXhpc3RzU3luYyhiYXNlUGF0aCkpXHJcblx0XHRmcy5ta2RpclN5bmMoYmFzZVBhdGgpO1xyXG5cclxuXHRpZiAocHNkLmNhbnZhcykge1xyXG5cdFx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oYmFzZVBhdGgsICdjYW52YXMucG5nJyksIHBzZC5jYW52YXMudG9CdWZmZXIoKSk7XHJcblx0XHRwc2QuY2FudmFzID0gdW5kZWZpbmVkO1xyXG5cdH1cclxuXHJcblx0cHNkLmNoaWxkcmVuIS5mb3JFYWNoKChsLCBpKSA9PiB7XHJcblx0XHRpZiAobC5jYW52YXMpIHtcclxuXHRcdFx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oYmFzZVBhdGgsIGBsYXllci0ke2l9LnBuZ2ApLCBsLmNhbnZhcy50b0J1ZmZlcigpKTtcclxuXHRcdFx0bC5jYW52YXMgPSB1bmRlZmluZWQ7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdGZzLndyaXRlRmlsZVN5bmMocGF0aC5qb2luKGJhc2VQYXRoLCAnZGF0YS5qc29uJyksIEpTT04uc3RyaW5naWZ5KHBzZCwgbnVsbCwgMikpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2F2ZUNhbnZhcyhmaWxlTmFtZTogc3RyaW5nLCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50IHwgdW5kZWZpbmVkKSB7XHJcblx0aWYgKGNhbnZhcykge1xyXG5cdFx0ZnMud3JpdGVGaWxlU3luYyhmaWxlTmFtZSwgY2FudmFzLnRvQnVmZmVyKCkpO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRDYW52YXNGcm9tRmlsZShmaWxlUGF0aDogc3RyaW5nKSB7XHJcblx0Y29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcblx0aW1nLnNyYyA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCk7XHJcblx0Y29uc3QgY2FudmFzID0gY3JlYXRlQ2FudmFzKGltZy53aWR0aCwgaW1nLmhlaWdodCk7XHJcblx0Y2FudmFzLmdldENvbnRleHQoJzJkJykhLmRyYXdJbWFnZShpbWcsIDAsIDApO1xyXG5cdHJldHVybiBjYW52YXM7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlVHdvRmlsZXMoZXhwZWN0ZWRQYXRoOiBzdHJpbmcsIGFjdHVhbDogVWludDhBcnJheSwgbmFtZTogc3RyaW5nKSB7XHJcblx0Y29uc3QgZXhwZWN0ZWRCdWZmZXIgPSBmcy5yZWFkRmlsZVN5bmMoZXhwZWN0ZWRQYXRoKTtcclxuXHRjb25zdCBleHBlY3RlZCA9IG5ldyBVaW50OEFycmF5KGV4cGVjdGVkQnVmZmVyLmJ1ZmZlciwgZXhwZWN0ZWRCdWZmZXIuYnl0ZU9mZnNldCwgZXhwZWN0ZWRCdWZmZXIuYnl0ZUxlbmd0aCk7XHJcblxyXG5cdGlmIChleHBlY3RlZC5ieXRlTGVuZ3RoICE9PSBhY3R1YWwuYnl0ZUxlbmd0aCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBGaWxlIHNpemUgaXMgZGlmZmVyZW50IHRoYW4gZXhwZWN0ZWQgKCR7bmFtZX0pYCk7XHJcblx0fVxyXG5cclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGV4cGVjdGVkLmJ5dGVMZW5ndGg7IGkrKykge1xyXG5cdFx0aWYgKGV4cGVjdGVkW2ldICE9PSBhY3R1YWxbaV0pIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBBY3R1YWwgZmlsZSBkaWZmZXJlbnQgdGhhbiBleHBlY3RlZCBhdCBpbmRleCAke2l9OiBhY3R1YWwgJHthY3R1YWxbaV19LCBleHBlY3RlZCAke2V4cGVjdGVkW2ldfWApO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVDYW52YXNlcyhleHBlY3RlZDogSFRNTENhbnZhc0VsZW1lbnQgfCB1bmRlZmluZWQsIGFjdHVhbDogSFRNTENhbnZhc0VsZW1lbnQgfCB1bmRlZmluZWQsIG5hbWU6IHN0cmluZykge1xyXG5cdGNvbnN0IHNhdmVGYWlsdXJlID0gKCkgPT4ge1xyXG5cdFx0Y29uc3QgZmFpbHVyZXNEaXIgPSBwYXRoLmpvaW4ocmVzdWx0c1BhdGgsICdmYWlsdXJlcycpO1xyXG5cdFx0aWYgKCFmcy5leGlzdHNTeW5jKGZhaWx1cmVzRGlyKSkge1xyXG5cdFx0XHRmcy5ta2RpclN5bmMoZmFpbHVyZXNEaXIpO1xyXG5cdFx0fVxyXG5cdFx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oZmFpbHVyZXNEaXIsIGAke25hbWUucmVwbGFjZSgvW1xcXFwvXS8sICctJyl9YCksIGFjdHVhbCEudG9CdWZmZXIoKSk7XHJcblx0fTtcclxuXHJcblx0aWYgKGV4cGVjdGVkID09PSBhY3R1YWwpXHJcblx0XHRyZXR1cm47XHJcblx0aWYgKCFleHBlY3RlZClcclxuXHRcdHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgY2FudmFzIGlzIG51bGwgKCR7bmFtZX0pYCk7XHJcblx0aWYgKCFhY3R1YWwpXHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEFjdHVhbCBjYW52YXMgaXMgbnVsbCAoJHtuYW1lfSlgKTtcclxuXHJcblx0aWYgKGV4cGVjdGVkLndpZHRoICE9PSBhY3R1YWwud2lkdGggfHwgZXhwZWN0ZWQuaGVpZ2h0ICE9PSBhY3R1YWwuaGVpZ2h0KSB7XHJcblx0XHRzYXZlRmFpbHVyZSgpO1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBDYW52YXMgc2l6ZSBpcyBkaWZmZXJlbnQgdGhhbiBleHBlY3RlZCAoJHtuYW1lfSlgKTtcclxuXHR9XHJcblxyXG5cdGNvbnN0IGV4cGVjdGVkRGF0YSA9IGV4cGVjdGVkLmdldENvbnRleHQoJzJkJykhLmdldEltYWdlRGF0YSgwLCAwLCBleHBlY3RlZC53aWR0aCwgZXhwZWN0ZWQuaGVpZ2h0KTtcclxuXHRjb25zdCBhY3R1YWxEYXRhID0gYWN0dWFsLmdldENvbnRleHQoJzJkJykhLmdldEltYWdlRGF0YSgwLCAwLCBhY3R1YWwud2lkdGgsIGFjdHVhbC5oZWlnaHQpO1xyXG5cdGNvbnN0IGxlbmd0aCA9IGV4cGVjdGVkRGF0YS53aWR0aCAqIGV4cGVjdGVkRGF0YS5oZWlnaHQgKiA0O1xyXG5cclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcblx0XHRpZiAoZXhwZWN0ZWREYXRhLmRhdGFbaV0gIT09IGFjdHVhbERhdGEuZGF0YVtpXSkge1xyXG5cdFx0XHRzYXZlRmFpbHVyZSgpO1xyXG5cdFx0XHRjb25zdCBleHBlY3RlZE51bUJ5dGVzID0gZXhwZWN0ZWREYXRhLmRhdGEubGVuZ3RoO1xyXG5cdFx0XHRjb25zdCBhY3R1YWxOdW1CeXRlcyA9IGFjdHVhbERhdGEuZGF0YS5sZW5ndGg7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcclxuXHRcdFx0XHRgQWN0dWFsIGNhbnZhcyAoJHthY3R1YWxOdW1CeXRlc30gYnl0ZXMpIGRpZmZlcmVudCBgICtcclxuXHRcdFx0XHRgdGhhbiBleHBlY3RlZCAoJHtuYW1lfTogJHtleHBlY3RlZE51bUJ5dGVzfSBieXRlcykgYCArXHJcblx0XHRcdFx0YGF0IGluZGV4ICR7aX06IGFjdHVhbCAke2FjdHVhbERhdGEuZGF0YVtpXX0gdnMuIGV4cGVjdGVkICR7ZXhwZWN0ZWREYXRhLmRhdGFbaV19YFxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVCdWZmZXJzKGFjdHVhbDogQnVmZmVyLCBleHBlY3RlZDogQnVmZmVyLCB0ZXN0OiBzdHJpbmcsIHN0YXJ0ID0gMCwgb2Zmc2V0ID0gMCkge1xyXG5cdGlmICghYWN0dWFsKVxyXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBBY3R1YWwgYnVmZmVyIGlzIG51bGwgb3IgdW5kZWZpbmVkICgke3Rlc3R9KWApO1xyXG5cdGlmICghZXhwZWN0ZWQpXHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGJ1ZmZlciBpcyBudWxsIG9yIHVuZGVmaW5lZCAoJHt0ZXN0fSlgKTtcclxuXHJcblx0Zm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZXhwZWN0ZWQubGVuZ3RoOyBpKyspIHtcclxuXHRcdGlmIChleHBlY3RlZFtpXSAhPT0gYWN0dWFsW2kgKyBvZmZzZXRdKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihgQnVmZmVycyBkaWZmZXIgYCArXHJcblx0XHRcdFx0YGV4cGVjdGVkOiAweCR7ZXhwZWN0ZWRbaV0udG9TdHJpbmcoMTYpfSBhdCBbMHgke2kudG9TdHJpbmcoMTYpfV0gYCArXHJcblx0XHRcdFx0YGFjdHVhbDogMHgke2FjdHVhbFtpICsgb2Zmc2V0XS50b1N0cmluZygxNil9IGF0IFsweCR7KGkgKyBvZmZzZXQpLnRvU3RyaW5nKDE2KX1dICgke3Rlc3R9KWApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0aWYgKGFjdHVhbC5sZW5ndGggIT09IGV4cGVjdGVkLmxlbmd0aClcclxuXHRcdHRocm93IG5ldyBFcnJvcihgQnVmZmVycyBkaWZmZXIgaW4gc2l6ZSBhY3R1YWw6ICR7YWN0dWFsLmxlbmd0aH0gZXhwZWN0ZWQ6ICR7ZXhwZWN0ZWQubGVuZ3RofSAoJHt0ZXN0fSlgKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBleHBlY3RCdWZmZXJzRXF1YWwoYWN0dWFsOiBVaW50OEFycmF5LCBleHBlY3RlZDogVWludDhBcnJheSwgbmFtZTogc3RyaW5nKSB7XHJcblx0Y29uc3QgbGVuZ3RoID0gTWF0aC5tYXgoYWN0dWFsLmxlbmd0aCwgZXhwZWN0ZWQubGVuZ3RoKTtcclxuXHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG5cdFx0aWYgKGFjdHVhbFtpXSAhPT0gZXhwZWN0ZWRbaV0pIHtcclxuXHRcdFx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAncmVzdWx0cycsIG5hbWUpLCBCdWZmZXIuZnJvbShhY3R1YWwpKTtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBEaWZmZXJlbnQgYnl0ZSBhdCAweCR7aS50b1N0cmluZygxNil9IGluICgke25hbWV9KWApO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6IkY6XFxwcm9qZWN0c1xcYWctcHNkXFxzcmMifQ==
