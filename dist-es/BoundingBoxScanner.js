import { createCanvas } from './helpers';
var BoundingBoxScan = /** @class */ (function () {
    function BoundingBoxScan() {
    }
    /**
     * Find the bounding box of the layer's transparency
     */
    BoundingBoxScan.prototype.scanLayerTransparency = function (layer) {
        var _a, _b, _c, _d, _e;
        var imageData = (_e = (_b = (_a = layer.canvas) === null || _a === void 0 ? void 0 : _a.getContext('2d')) === null || _b === void 0 ? void 0 : _b.getImageData(0, 0, (_c = layer.canvas) === null || _c === void 0 ? void 0 : _c.width, (_d = layer.canvas) === null || _d === void 0 ? void 0 : _d.height)) === null || _e === void 0 ? void 0 : _e.data.buffer;
        if (imageData && layer.canvas) {
            return this.scan(new Uint8ClampedArray(imageData), layer.canvas.width, layer.canvas.height);
        }
        else {
            return undefined;
        }
    };
    BoundingBoxScan.prototype.cropLayerToBoundingBox = function (layer) {
        var boundingBox = this.scanLayerTransparency(layer);
        if (boundingBox) {
            var width = boundingBox.right - boundingBox.left;
            var height = boundingBox.bottom - boundingBox.top;
            var newCanvas = createCanvas(width, height);
            var ctx = newCanvas.getContext('2d');
            ctx.drawImage(layer.canvas, boundingBox.left, boundingBox.top, width, height, 0, 0, width, height);
            layer.canvas = newCanvas;
            layer.top = boundingBox.top;
            layer.bottom = boundingBox.bottom;
            layer.left = boundingBox.left;
            layer.right = boundingBox.right;
            layer.imageData = ctx.getImageData(0, 0, width, height);
        }
    };
    /**
     * Scan the entire image for a rectangle in the set channel
     */
    BoundingBoxScan.prototype.scan = function (d, w, h, scanOffset) {
        if (scanOffset === void 0) { scanOffset = BoundingBoxScan.SCAN_OFFSET_ALPHA; }
        var x;
        var y;
        var ptr;
        var output = {
            left: 0,
            top: 0,
            right: 0,
            bottom: 0,
        };
        for (x = 0; x < w; x += 1) {
            for (y = 0; y < h; y += 1) {
                ptr = (x + (y * w)) * 4;
                if (d[ptr + scanOffset] > 250) {
                    if (output.left === 0) {
                        output.left = x;
                    }
                    if (output.top === 0) {
                        output.top = y;
                    }
                    output.right = Math.max(output.right, x);
                    output.bottom = Math.max(output.bottom, y);
                }
            }
        }
        return output;
    };
    BoundingBoxScan.SCAN_OFFSET_RED = 0;
    BoundingBoxScan.SCAN_OFFSET_GREEN = 1;
    BoundingBoxScan.SCAN_OFFSET_BLUE = 2;
    BoundingBoxScan.SCAN_OFFSET_ALPHA = 3;
    return BoundingBoxScan;
}());
export { BoundingBoxScan };

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJvdW5kaW5nQm94U2Nhbm5lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBU3ZDO0lBQUE7SUFrRUEsQ0FBQztJQTVEQTs7T0FFRztJQUNJLCtDQUFxQixHQUE1QixVQUE2QixLQUE0Qjs7UUFDeEQsSUFBTSxTQUFTLEdBQUcsTUFBQSxNQUFBLE1BQUEsS0FBSyxDQUFDLE1BQU0sMENBQUUsVUFBVSxDQUFDLElBQUksQ0FBQywwQ0FBRSxZQUFZLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxNQUFBLEtBQUssQ0FBQyxNQUFNLDBDQUFFLEtBQUssRUFBRSxNQUFBLEtBQUssQ0FBQyxNQUFNLDBDQUFFLE1BQU0sQ0FBQywwQ0FBRSxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzNILElBQUksU0FBUyxJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUU7WUFDOUIsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksaUJBQWlCLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUM1RjthQUFNO1lBQ04sT0FBTyxTQUFTLENBQUM7U0FDakI7SUFDRixDQUFDO0lBRU0sZ0RBQXNCLEdBQTdCLFVBQThCLEtBQVk7UUFDekMsSUFBTSxXQUFXLEdBQTZCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoRixJQUFJLFdBQVcsRUFBRTtZQUNoQixJQUFNLEtBQUssR0FBVyxXQUFXLENBQUMsS0FBSyxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUM7WUFDM0QsSUFBTSxNQUFNLEdBQVcsV0FBVyxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDO1lBQzVELElBQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDOUMsSUFBTSxHQUFHLEdBQTZCLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUE2QixDQUFDO1lBQzdGLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU8sRUFBRSxXQUFXLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNwRyxLQUFLLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztZQUN6QixLQUFLLENBQUMsR0FBRyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUM7WUFDNUIsS0FBSyxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDO1lBQ2xDLEtBQUssQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQztZQUM5QixLQUFLLENBQUMsS0FBSyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUM7WUFDaEMsS0FBSyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ3hEO0lBQ0YsQ0FBQztJQUVEOztPQUVHO0lBQ0ssOEJBQUksR0FBWixVQUFhLENBQW9CLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBRSxVQUFzRDtRQUF0RCwyQkFBQSxFQUFBLGFBQXFCLGVBQWUsQ0FBQyxpQkFBaUI7UUFDOUcsSUFBSSxDQUFTLENBQUM7UUFDZCxJQUFJLENBQVMsQ0FBQztRQUNkLElBQUksR0FBVyxDQUFDO1FBQ2hCLElBQU0sTUFBTSxHQUFpQjtZQUM1QixJQUFJLEVBQUUsQ0FBQztZQUNQLEdBQUcsRUFBRSxDQUFDO1lBQ04sS0FBSyxFQUFFLENBQUM7WUFDUixNQUFNLEVBQUUsQ0FBQztTQUNULENBQUM7UUFDRixLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzFCLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzFCLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEdBQUcsRUFBRTtvQkFDOUIsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsRUFBRTt3QkFDdEIsTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7cUJBQ2hCO29CQUNELElBQUksTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLEVBQUU7d0JBQ3JCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3FCQUNmO29CQUNELE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO29CQUN6QyxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztpQkFDM0M7YUFDRDtTQUNEO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDZixDQUFDO0lBL0RhLCtCQUFlLEdBQVcsQ0FBQyxDQUFDO0lBQzVCLGlDQUFpQixHQUFXLENBQUMsQ0FBQztJQUM5QixnQ0FBZ0IsR0FBVyxDQUFDLENBQUM7SUFDN0IsaUNBQWlCLEdBQVcsQ0FBQyxDQUFDO0lBOEQ3QyxzQkFBQztDQWxFRCxBQWtFQyxJQUFBO1NBbEVZLGVBQWUiLCJmaWxlIjoiQm91bmRpbmdCb3hTY2FubmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEEgdG9vbCBmb3IgZmluZGluZyB0aGUgYm91bmRpbmcgYm94IGFyb3VuZCBhIHNldCBvZiBjb2xvcmVkIHBpeGVsc1xyXG4gKi9cclxuaW1wb3J0IHtMYXllciwgTGF5ZXJNYXNrRGF0YX0gZnJvbSAnLi9wc2QnO1xyXG5pbXBvcnQge2NyZWF0ZUNhbnZhc30gZnJvbSAnLi9oZWxwZXJzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSUJvdW5kaW5nQm94IHtcclxuXHRsZWZ0OiBudW1iZXI7XHJcblx0dG9wOiBudW1iZXI7XHJcblx0cmlnaHQ6IG51bWJlcjtcclxuXHRib3R0b206IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEJvdW5kaW5nQm94U2NhbiB7XHJcblx0cHVibGljIHN0YXRpYyBTQ0FOX09GRlNFVF9SRUQ6IG51bWJlciA9IDA7XHJcblx0cHVibGljIHN0YXRpYyBTQ0FOX09GRlNFVF9HUkVFTjogbnVtYmVyID0gMTtcclxuXHRwdWJsaWMgc3RhdGljIFNDQU5fT0ZGU0VUX0JMVUU6IG51bWJlciA9IDI7XHJcblx0cHVibGljIHN0YXRpYyBTQ0FOX09GRlNFVF9BTFBIQTogbnVtYmVyID0gMztcclxuXHJcblx0LyoqXHJcblx0ICogRmluZCB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBsYXllcidzIHRyYW5zcGFyZW5jeVxyXG5cdCAqL1xyXG5cdHB1YmxpYyBzY2FuTGF5ZXJUcmFuc3BhcmVuY3kobGF5ZXI6IExheWVyIHwgTGF5ZXJNYXNrRGF0YSk6IElCb3VuZGluZ0JveCB8IHVuZGVmaW5lZCB7XHJcblx0XHRjb25zdCBpbWFnZURhdGEgPSBsYXllci5jYW52YXM/LmdldENvbnRleHQoJzJkJyk/LmdldEltYWdlRGF0YSgwLDAsbGF5ZXIuY2FudmFzPy53aWR0aCwgbGF5ZXIuY2FudmFzPy5oZWlnaHQpPy5kYXRhLmJ1ZmZlcjtcclxuXHRcdGlmIChpbWFnZURhdGEgJiYgbGF5ZXIuY2FudmFzKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnNjYW4obmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGltYWdlRGF0YSksIGxheWVyLmNhbnZhcy53aWR0aCwgbGF5ZXIuY2FudmFzLmhlaWdodCk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHVibGljIGNyb3BMYXllclRvQm91bmRpbmdCb3gobGF5ZXI6IExheWVyKTogdm9pZCB7XHJcblx0XHRjb25zdCBib3VuZGluZ0JveDogSUJvdW5kaW5nQm94IHwgdW5kZWZpbmVkID0gdGhpcy5zY2FuTGF5ZXJUcmFuc3BhcmVuY3kobGF5ZXIpO1xyXG5cdFx0aWYgKGJvdW5kaW5nQm94KSB7XHJcblx0XHRcdGNvbnN0IHdpZHRoOiBudW1iZXIgPSBib3VuZGluZ0JveC5yaWdodCAtIGJvdW5kaW5nQm94LmxlZnQ7XHJcblx0XHRcdGNvbnN0IGhlaWdodDogbnVtYmVyID0gYm91bmRpbmdCb3guYm90dG9tIC0gYm91bmRpbmdCb3gudG9wO1xyXG5cdFx0XHRjb25zdCBuZXdDYW52YXMgPSBjcmVhdGVDYW52YXMod2lkdGgsIGhlaWdodCk7XHJcblx0XHRcdGNvbnN0IGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEID0gbmV3Q2FudmFzLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG5cdFx0XHRjdHguZHJhd0ltYWdlKGxheWVyLmNhbnZhcyEsIGJvdW5kaW5nQm94LmxlZnQsIGJvdW5kaW5nQm94LnRvcCwgd2lkdGgsIGhlaWdodCwgMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcblx0XHRcdGxheWVyLmNhbnZhcyA9IG5ld0NhbnZhcztcclxuXHRcdFx0bGF5ZXIudG9wID0gYm91bmRpbmdCb3gudG9wO1xyXG5cdFx0XHRsYXllci5ib3R0b20gPSBib3VuZGluZ0JveC5ib3R0b207XHJcblx0XHRcdGxheWVyLmxlZnQgPSBib3VuZGluZ0JveC5sZWZ0O1xyXG5cdFx0XHRsYXllci5yaWdodCA9IGJvdW5kaW5nQm94LnJpZ2h0O1xyXG5cdFx0XHRsYXllci5pbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogU2NhbiB0aGUgZW50aXJlIGltYWdlIGZvciBhIHJlY3RhbmdsZSBpbiB0aGUgc2V0IGNoYW5uZWxcclxuXHQgKi9cclxuXHRwcml2YXRlIHNjYW4oZDogVWludDhDbGFtcGVkQXJyYXksIHc6IG51bWJlciwgaDogbnVtYmVyLCBzY2FuT2Zmc2V0OiBudW1iZXIgPSBCb3VuZGluZ0JveFNjYW4uU0NBTl9PRkZTRVRfQUxQSEEpOiBJQm91bmRpbmdCb3gge1xyXG5cdFx0bGV0IHg6IG51bWJlcjtcclxuXHRcdGxldCB5OiBudW1iZXI7XHJcblx0XHRsZXQgcHRyOiBudW1iZXI7XHJcblx0XHRjb25zdCBvdXRwdXQ6IElCb3VuZGluZ0JveCA9IHtcclxuXHRcdFx0bGVmdDogMCxcclxuXHRcdFx0dG9wOiAwLFxyXG5cdFx0XHRyaWdodDogMCxcclxuXHRcdFx0Ym90dG9tOiAwLFxyXG5cdFx0fTtcclxuXHRcdGZvciAoeCA9IDA7IHggPCB3OyB4ICs9IDEpIHtcclxuXHRcdFx0Zm9yICh5ID0gMDsgeSA8IGg7IHkgKz0gMSkge1xyXG5cdFx0XHRcdHB0ciA9ICh4ICsgKHkgKiB3KSkgKiA0O1xyXG5cdFx0XHRcdGlmIChkW3B0ciArIHNjYW5PZmZzZXRdID4gMjUwKSB7XHJcblx0XHRcdFx0XHRpZiAob3V0cHV0LmxlZnQgPT09IDApIHtcclxuXHRcdFx0XHRcdFx0b3V0cHV0LmxlZnQgPSB4O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKG91dHB1dC50b3AgPT09IDApIHtcclxuXHRcdFx0XHRcdFx0b3V0cHV0LnRvcCA9IHk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRvdXRwdXQucmlnaHQgPSBNYXRoLm1heChvdXRwdXQucmlnaHQsIHgpO1xyXG5cdFx0XHRcdFx0b3V0cHV0LmJvdHRvbSA9IE1hdGgubWF4KG91dHB1dC5ib3R0b20sIHkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG91dHB1dDtcclxuXHR9XHJcblxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiRjpcXHByb2plY3RzXFxhZy1wc2RcXHNyYyJ9
